<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Votaciones Eurovisión 2025</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Votaciones Eurovisión 2025</h1>
    <form id="voteForm">
      <input type="text" id="name" placeholder="Tu nombre" required />
      <label for="country">Elige tu canción favorita:</label>
        <select id="country" required>
          <option value="" disabled selected>Selecciona un país</option>
          <option value="Noruega - Kyle Alessandro - Lighter">Noruega - Kyle Alessandro - «Lighter»</option>
          <option value="Luxemburgo - Laura Thorn - La poupée monte le son">Luxemburgo - Laura Thorn - «La poupée monte le son»</option>
          <option value="Estonia - Tommy Cash - Espresso Macchiato">Estonia - Tommy Cash - «Espresso Macchiato»</option>
          <option value="Israel - Yuval Raphael - New day will rise">Israel - Yuval Raphael - «New day will rise»</option>
          <option value="Lituania - Katarsis - Tavo akys">Lituania - Katarsis - «Tavo akys»</option>
          <option value="España - Melody - Esa diva">España - Melody - «Esa diva»</option>
          <option value="Ucrania - Ziferblat - Bird of Pray">Ucrania - Ziferblat - «Bird of Pray»</option>
          <option value="Reino Unido - Remember Monday - What the hell just happened?">Reino Unido - Remember Monday - «What the hell just happened?»</option>
          <option value="Austria - JJ - Wasted Love">Austria - JJ - «Wasted Love»</option>
          <option value="Islandia - Væb - RÓA">Islandia - Væb - «RÓA»</option>
          <option value="Letonia - Tautumeitas - Bur man laimi">Letonia - Tautumeitas - «Bur man laimi»</option>
          <option value="Países Bajos - Claude - C'est la vie">Países Bajos - Claude - «C'est la vie»</option>
          <option value="Finlandia - Erika Vikman - Ich komme">Finlandia - Erika Vikman - «Ich komme»</option>
          <option value="Italia - Lucio Corsi - Volevo essere un duro">Italia - Lucio Corsi - «Volevo essere un duro»</option>
          <option value="Polonia - Justyna Steczkowska - Gaja">Polonia - Justyna Steczkowska - «Gaja»</option>
          <option value="Alemania - Abor & Tynna - Baller">Alemania - Abor & Tynna - «Baller»</option>
          <option value="Grecia - Klavdia - Asteromáta">Grecia - Klavdia - «Asteromáta»</option>
          <option value="Armenia - Parg - Survivor">Armenia - Parg - «Survivor»</option>
          <option value="Suiza - Zoë Më - Voyage">Suiza - Zoë Më - «Voyage»</option>
          <option value="Malta - Miriana Conte - Serving">Malta - Miriana Conte - «Serving»</option>
          <option value="Portugal - Napa - Deslocado">Portugal - Napa - «Deslocado»</option>
          <option value="Dinamarca - Sissal - Hallucination">Dinamarca - Sissal - «Hallucination»</option>
          <option value="Suecia - KAJ - Bara bada bastu">Suecia - KAJ - «Bara bada bastu»</option>
          <option value="Francia - Louane - Maman">Francia - Louane - «Maman»</option>
          <option value="San Marino - Gabry Ponte - Tutta l'Italia">San Marino - Gabry Ponte - «Tutta l'Italia»</option>
          <option value="Albania - Shkodra Elektronike - Zjerm">Albania - Shkodra Elektronike - «Zjerm»</option>
        </select>
      <button type="submit">Votar</button>
    </form>

    <h2>Resultados en vivo</h2>
    <ul id="resultsList">Cargando resultados...</ul>
  </div>

  <script>
    const voteForm = document.getElementById("voteForm");
    const resultsList = document.getElementById("resultsList");

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzBNZ1x074LszOoVNIUogeB7Cgv43PiwabwB73HBe2LiFwDby6RIEnQqiFNQpeW2IvQsw/exec";

    voteForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const country = document.getElementById("country").value;

      if (!name || !country) return;

      const voteData = { name, country };

      await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(voteData),
        headers: {
          "Content-Type": "application/json",
        },
      });

      voteForm.reset();
      alert("¡Voto enviado!");
    });

    async function getResultsFromSheet() {
      const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTlWW2frQC17TbpRh6jf99xBIaRhEKvLxniz8kEeoLUXLnI4EgFCBug-NM7dOAjSW4b9TJD9llqPbrc/pub?gid=0&single=true&output=csv"; // Lo explico abajo
      const response = await fetch(sheetURL);
      const text = await response.text();

      const lines = text.trim().split("\n").slice(1); // Skip headers
      const counts = {};

      for (let line of lines) {
        const [name, country] = line.split(",");
        counts[country] = (counts[country] || 0) + 1;
      }

      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      resultsList.innerHTML = "";
      sorted.forEach(([country, votes]) => {
        const li = document.createElement("li");
        li.textContent = `${country}: ${votes} voto(s)`;
        resultsList.appendChild(li);
      });
    }

    // Actualizar cada 5 segundos
    setInterval(getResultsFromSheet, 5000);
    getResultsFromSheet();
  </script>
</body>
</html>
